# GitHub Dependabot設定仕様

## GitHub Dependabotとは

**GitHub Dependabot**は、GitHubが提供する**依存関係の自動更新サービス**です。

### 基本的な仕組み
1. **自動監視**: プロジェクトで使用しているライブラリ（React、Next.js、TypeScriptなど）を常時監視
2. **更新検出**: 新しいバージョンやセキュリティ修正を自動検出
3. **PR自動作成**: 更新が必要な場合、自動でPull Requestを作成
4. **開発者確認**: 開発者がPRを確認してマージするだけ

### なぜ必要なのか

#### 従来の手動管理の問題
- **更新忘れ**: 「そういえば最近ライブラリ更新してないな...」
- **セキュリティリスク**: 脆弱性のあるバージョンを使い続ける危険性
- **手動作業**: `pnpm audit`などを定期的に実行する手間
- **見落とし**: 重要な更新に気づかない

#### Dependabotによる解決
- **自動検出**: 新しいバージョンやセキュリティ問題を即座に発見
- **即座対応**: セキュリティ問題は緊急でPR作成
- **作業軽減**: 手動チェック不要、PRの確認・マージのみ
- **漏れなし**: すべての依存関係を網羅的に監視

### 実際の動作例

#### セキュリティ問題発見時
```
1. Dependabot: 「Next.jsにセキュリティ脆弱性発見！」
2. 自動でPR作成: 「Next.js v14.1.0 → v14.1.4 (セキュリティ修正)」
3. あなた: PRを確認してマージボタンクリック
4. 結果: セキュリティ問題即座に解決
```

#### 通常の更新時
```
1. Dependabot: 「Reactの新バージョンが利用可能です」
2. 自動でPR作成: 「React v18.2.0 → v18.3.0 (機能追加)」
3. あなた: テストを確認してマージ
4. 結果: 最新機能を活用可能
```

## 概要

本ドキュメントは、ポートフォリオサイトに実装したGitHub Dependabotの設定仕様書です。T3 Turboモノレポ構成に最適化された包括的な依存関係管理を実現し、**企業レベルのセキュリティ・品質管理を自動化**します。

## 実装日

**作成日**: 2025-07-12  
**Linear Issue**: ARO-73  
**Pull Request**: #42

## 基本設定

### 設定ファイル

- **パス**: `.github/dependabot.yml`
- **バージョン**: version 2
- **対象**: T3 Turbo モノレポ全体

### 更新対象

#### npm パッケージエコシステム

1. **ルートワークスペース** (`/`)
2. **Next.jsアプリケーション** (`/apps/nextjs`)
3. **パッケージ群** (`/packages/*`)
   - `/packages/api` - tRPCルーター
   - `/packages/auth` - 認証システム
   - `/packages/db` - データベースレイヤー
   - `/packages/external` - 外部サービス統合
   - `/packages/ui` - UIコンポーネント
   - `/packages/validators` - バリデーションスキーマ
4. **toolingパッケージ** (`/tooling`)

#### GitHub Actionsエコシステム

- ワークフロー定義ファイル (`/.github/workflows/*`)

## スケジュール設定

### 実行タイミング（日本時間ベース）

#### 火曜日: メインパッケージ

- **09:00**: ルートワークスペース
- **09:30**: Next.jsアプリ
- **10:00-11:15**: パッケージ群（15分間隔）

#### 水曜日: 開発ツール

- **09:00**: toolingパッケージ

#### 金曜日: CI/CD

- **09:00**: GitHub Actionsワークフロー

### スケジュール設計思想

- **時間差実行**: 同時PR作成による競合回避
- **平日実行**: 平日作業時間での迅速対応
- **分散処理**: システム負荷軽減

## PR管理設定

### PR制限数

- **ルート**: 5個
- **Next.js**: 3個
- **各パッケージ**: 2個
- **tooling**: 3個
- **GitHub Actions**: 3個

### 自動設定

- **レビュー担当**: aromarious
- **アサイン**: aromarious
- **コミットメッセージプレフィックス**:
  - パッケージ更新: `⬆️`
  - tooling更新: `🔧`

## セキュリティ設定

### 優先処理

1. **セキュリティアップデート**: 最高優先度
2. **脆弱性修正**: 即座のPR作成
3. **GitHub Security Advisory Database**: 自動連携

### 更新タイプ

- **all dependency types**: 全依存関係対象
- **直接・間接依存関係**: 両方対応

## グループ化設定

### minor-and-patch グループ

```yaml
patterns: ['*']
update-types: ['minor', 'patch']
```

- **目的**: 小規模更新の統合
- **効果**: PR数削減・レビュー効率化

### security グループ

```yaml
patterns: ['*']
update-types: ['security']
```

- **目的**: セキュリティ更新の独立管理
- **効果**: 緊急対応の迅速化

### tooling-updates グループ

```yaml
patterns:
  ['@eslint/*', 'eslint*', '@typescript-eslint/*', 'prettier*', '@prettier/*', 'turbo*', '@turbo/*']
update-types: ['minor', 'patch']
```

- **目的**: 開発ツール更新の統合
- **効果**: 開発環境の一括更新

## 既存システムとの統合

### Renovatebot

- **現状**: `.github/renovate.json`が存在
- **対応**: Dependabotとの競合回避設定
- **@aromarious/パッケージ**: Renovatebotで無効化済み

### 手動運用からの移行

- **従来**: `pnpm audit`手動実行
- **新方式**: 自動PR作成・レビューフロー
- **月次確認**: 自動化による効率化

## 設定詳細

### コミットメッセージ設定

```yaml
commit-message:
  prefix: '⬆️' # or "🔧" for tooling
  include: 'scope'
```

### allow設定

```yaml
allow:
  - dependency-type: 'all'
```

### timezone設定

```yaml
timezone: 'Asia/Tokyo'
```

## 期待効果

### あなたにとってのメリット

#### セキュリティ面
- **安心感**: セキュリティ問題を自動検出・即座対応
- **リスク軽減**: 脆弱性のあるライブラリを放置しない
- **最新対策**: 常に最新のセキュリティ対策を適用

#### 作業効率
- **時間節約**: 手動での`pnpm audit`実行が不要
- **見落とし防止**: すべての依存関係を自動監視
- **簡単操作**: PRが来たら確認・マージするだけ

#### 技術力アピール
- **企業レベル運用**: 就職活動で「自動化された運用体制」をアピール
- **最新技術**: 常に新しいバージョンを使用していることを示せる
- **セキュリティ意識**: セキュリティに配慮した開発姿勢をアピール

### システム全体のメリット

#### セキュリティ強化
- **脆弱性検出**: 週次自動スキャン
- **迅速対応**: 即座のPR作成
- **継続監視**: GitHub Security Advisory連携

#### 運用効率化
- **自動化**: 手動更新作業削減
- **グループ化**: レビュー負荷軽減
- **スケジュール**: 計画的な更新管理

#### 企業レベル運用
- **包括的監視**: 全依存関係カバー
- **標準化**: 一貫した更新プロセス
- **トレーサビリティ**: PR履歴による変更追跡

## 実際の運用フロー

### あなたが体験する流れ

#### 通常の更新（週1回程度）
```
1. 火曜日の朝に通知が来る
   「Dependabotから3件のPRが作成されました」

2. GitHub でPRを確認
   - 「React 18.2.0 → 18.3.0 にアップデート」
   - 「TypeScript 5.3.0 → 5.4.0 にアップデート」
   - 「ESLint関連を一括アップデート」

3. 内容確認
   - CIテストが通っているかチェック
   - 破壊的変更がないか確認

4. マージボタンをクリック
   - 問題なければ「Merge pull request」

5. 完了
   - 自動的に最新バージョンに更新完了
```

#### 緊急セキュリティ更新（必要時のみ）
```
1. いきなり通知が来る
   「🚨緊急：Next.jsにセキュリティ脆弱性が発見されました」

2. 優先的にPR確認
   - 「Next.js 14.1.0 → 14.1.4 (セキュリティ修正)」

3. 即座にマージ
   - セキュリティ問題なので最優先対応

4. 安全確保
   - セキュリティリスク即座に解決
```

### システム側の自動処理

#### 通常更新フロー
1. **自動検出**: 週次スケジュール実行
2. **PR作成**: グループ化された更新
3. **レビュー**: aromariousによる確認
4. **マージ**: 検証後の統合

#### セキュリティ更新フロー
1. **即座検出**: 脆弱性発見時
2. **緊急PR**: セキュリティグループで独立作成
3. **優先レビュー**: 迅速な対応
4. **緊急マージ**: セキュリティ確保

## 関連ドキュメント

- **Linear Issue**: [ARO-73](https://linear.app/aromarious/issue/ARO-73)
- **Pull Request**: [#42](https://github.com/aromarious/portfolio02/pull/42)
- **設定ファイル**: [.github/dependabot.yml](../../.github/dependabot.yml)
- **依存関係スキャン**: ARO-62（関連Issue）

## 更新履歴

| 日付       | 変更内容                           | 担当者     |
| ---------- | ---------------------------------- | ---------- |
| 2025-07-12 | 初期設定・包括的Dependabot設定実装 | aromarious |

---

**注記**: この設定は企業レベルの依存関係管理を個人ポートフォリオに適用したものであり、セキュリティベストプラクティスと運用効率のバランスを重視している。
