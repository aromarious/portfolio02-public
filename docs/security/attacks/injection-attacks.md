# コード注入攻撃の詳細

## Reflected XSS

**攻撃手法**: URLパラメータ経由でスクリプトを注入し、即座に実行させる攻撃
**特徴**:

- URLパラメータの直接出力
- 検索結果やエラーメッセージでの反映
- 一時的な攻撃（ページリロードで消失）

**影響**:

- セッション情報の窃取
- 一時的な画面改ざん
- 他サイトへの不正リダイレクト

**検出方法**:

- URLパラメータ内のスクリプトタグ
- 異常なJavaScript実行パターン
- 特殊文字の異常な使用

## Stored XSS

**攻撃手法**: データベースに保存されたスクリプトが他ユーザーのブラウザで実行される攻撃
**特徴**:

- コメント欄やプロフィール情報への注入
- 永続的な攻撃（データ削除まで継続）
- 複数ユーザーへの自動的な影響

**影響**:

- 大規模なセッション乗っ取り
- ユーザーデータの大量窃取
- サイト全体の信頼性失墜

**検出方法**:

- データベース内のスクリプトコード
- 異常なJavaScript実行ログ
- ユーザーからの画面異常報告

## DOM-based XSS

**攻撃手法**: JavaScript実行時のDOM操作による動的なスクリプト注入攻撃
**特徴**:

- クライアントサイドでのみ発生
- URLハッシュやlocalStorageの悪用
- サーバーサイドでの検出困難

**影響**:

- クライアントサイドでの任意コード実行
- ローカルストレージの改ざん
- 単一ページアプリケーションでの影響拡大

**検出方法**:

- ブラウザのセキュリティログ
- 異常なDOM操作パターン
- JavaScriptエラーの分析

## SQL Injection

**攻撃手法**: SQLクエリに悪意のあるコードを注入してデータベースを不正操作
**特徴**:

- 入力値の不適切な処理
- 動的クエリ生成の脆弱性
- データベース管理者権限の奪取可能性

**影響**:

- データベース全体の情報漏洩
- データの改ざん・削除
- サーバーの完全制御

**検出方法**:

- 異常なSQL構文エラー
- 予期しないクエリ実行パターン
- データベースログの分析

## UNION攻撃

**攻撃手法**: SQL UNIONを使って異なるテーブルのデータを不正取得
**特徴**:

- SQL Injectionの発展形
- 複数テーブルの結合クエリ
- 大量データの一括取得

**影響**:

- 全データベースの情報漏洩
- ユーザー情報の大量窃取
- システム設定情報の露出

**検出方法**:

- UNION構文の異常な使用
- 予期しないテーブル結合
- 大量データ取得クエリ

## Command Injection

**攻撃手法**: OSコマンドを不正に実行してサーバーを制御する攻撃
**特徴**:

- システムコマンドの直接実行
- ファイル操作やプロセス制御
- 完全なサーバー制御の可能性

**影響**:

- サーバーの完全制御
- ファイルシステムの破壊
- 他システムへの攻撃拠点化

**検出方法**:

- 異常なプロセス実行
- システムコマンドの監視
- ファイルシステムの異常変更

## Template Injection

**攻撃手法**: テンプレートエンジンの脆弱性を悪用してサーバーサイドコードを実行
**特徴**:

- テンプレート構文の悪用
- サーバーサイドでの任意コード実行
- 環境変数やファイルへのアクセス

**影響**:

- サーバーサイドでの任意コード実行
- 機密情報の漏洩
- システム設定の改ざん

**検出方法**:

- テンプレート構文の異常な使用
- 予期しないテンプレート実行
- サーバーサイドエラーの分析

---

## インジェクション攻撃の現状と対策

### Reflected XSS

**現状と対策**:

- 現状: URLパラメータを直接出力していない
- 対策: CSP設定により根本的な防御
- 結果: 十分な防御

### Stored XSS

**現状と対策**:

- 現状: contact formデータがDBとNotionに保存される（要注意）
- 対策: CSP設定 + Zodスキーマによる入力検証
- 結果: CSP設定済みにより十分な防御

### DOM-based XSS

**現状と対策**:

- 現状: React使用によりリスク軽減済み
- 対策: CSP設定で追加防御
- 結果: 十分な防御

### SQL Injection / UNION攻撃

**現状と対策**:

- 現状: Drizzle ORMによるパラメータ化クエリで完全防御
- 対策: 生SQL使用禁止の継続
- 結果: SQL Injection攻撃に対して完全防御

### Command Injection

**現状と対策**:

- 現状: OSコマンド実行なし
- 対策: 今後もOSコマンド実行の回避
- 結果: Command Injection攻撃は該当なし

### Template Injection

**現状と対策**:

- 現状: Next.js/Reactテンプレートで安全
- 対策: サーバーサイドテンプレート使用回避
- 結果: Template Injection攻撃は該当なし
